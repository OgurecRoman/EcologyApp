(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{884:(e,s,a)=>{Promise.resolve().then(a.bind(a,4956))},4956:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>j});var t=a(5155),n=a(237),l=a(2115),r=a(6046),c=a(2021),i=a(504),d=a(8494),o=a(3596);function h(e){let{event:s,isJoined:a,userId:n,onJoinSuccess:h}=e,v=(0,r.useRouter)(),{setSelectedEvent:m}=(0,o.v)(),[u,p]=(0,l.useState)(!1),[j,x]=(0,l.useState)(a),N=async()=>{if(!n){alert("Необходима авторизация");return}try{p(!0),await (0,i.ns)(n,s.id),x(!0),h&&h()}catch(e){console.error("Failed to join event:",e),alert("Ошибка при записи на событие")}finally{p(!1)}};return(0,t.jsxs)("div",{className:"event-card",children:[(0,t.jsxs)("div",{className:"event-card-header",children:[(0,t.jsx)("h3",{className:"event-card-title",children:s.name}),(0,t.jsx)("span",{className:"event-card-type",children:d.S[s.type]||s.type})]}),(0,t.jsxs)("div",{className:"event-card-body",children:[s.description&&(0,t.jsx)("p",{className:"event-card-description",children:s.description}),(0,t.jsxs)("div",{className:"event-card-info",children:[(0,t.jsxs)("div",{className:"event-card-info-item",children:[(0,t.jsx)("span",{className:"event-card-label",children:"Дата:"}),(0,t.jsx)("span",{children:new Date(s.date).toLocaleDateString("ru-RU")})]}),(0,t.jsxs)("div",{className:"event-card-info-item",children:[(0,t.jsx)("span",{className:"event-card-label",children:"Адрес:"}),(0,t.jsx)("span",{children:s.address})]}),(0,t.jsxs)("div",{className:"event-card-info-item",children:[(0,t.jsx)("span",{className:"event-card-label",children:"Автор:"}),(0,t.jsx)("span",{children:s.author})]})]})]}),(0,t.jsxs)("div",{className:"event-card-actions",children:[(0,t.jsx)(c.$n,{onClick:()=>{m(s),v.push("/")},className:"event-card-btn-secondary",children:"Показать на карте"}),j?(0,t.jsx)("div",{className:"event-card-joined",children:"Вы записаны!"}):(0,t.jsx)(c.$n,{onClick:N,disabled:u,className:"event-card-btn-primary",children:u?"Запись...":"Записаться"})]})]})}function v(e){let{onClose:s,onSuccess:a,userId:n}=e,[r,o]=(0,l.useState)({name:"",description:"",type:d.B.SUBBOTNIK,date:"",address:"",author:""}),[h,v]=(0,l.useState)(!1),[m,u]=(0,l.useState)({}),p=e=>{let{name:s,value:a}=e.target;o(e=>({...e,[s]:a})),m[s]&&u(e=>({...e,[s]:""}))},j=()=>{let e={};return r.name.trim()||(e.name="Название обязательно"),r.type||(e.type="Выберите тип события"),r.date||(e.date="Дата обязательна"),r.address.trim()||(e.address="Адрес обязателен"),r.author.trim()||(e.author="Автор обязателен"),u(e),0===Object.keys(e).length},x=async e=>{if(e.preventDefault(),j())try{v(!0),await (0,i.lh)({...r,userId:n}),null==a||a(),s()}catch(e){console.error("Failed to create event:",e),alert("Ошибка при создании события")}finally{v(!1)}};return(0,t.jsx)("div",{className:"event-form-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"event-form-modal",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"event-form-header",children:[(0,t.jsx)("h2",{children:"Добавить событие"}),(0,t.jsx)(c.$n,{onClick:s,className:"event-form-close",children:"\xd7"})]}),(0,t.jsxs)("form",{onSubmit:x,className:"event-form",children:[(0,t.jsxs)("div",{className:"event-form-field",children:[(0,t.jsx)("label",{children:"Название *"}),(0,t.jsx)("input",{type:"text",name:"name",value:r.name,onChange:p,placeholder:"Введите название события"}),m.name&&(0,t.jsx)("span",{className:"event-form-error",children:m.name})]}),(0,t.jsxs)("div",{className:"event-form-field",children:[(0,t.jsx)("label",{children:"Описание"}),(0,t.jsx)("textarea",{name:"description",value:r.description,onChange:p,placeholder:"Описание события",rows:4})]}),(0,t.jsxs)("div",{className:"event-form-field",children:[(0,t.jsx)("label",{children:"Тип события *"}),(0,t.jsx)("select",{name:"type",value:r.type,onChange:p,children:Object.values(d.B).map(e=>(0,t.jsx)("option",{value:e,children:d.S[e]},e))}),m.type&&(0,t.jsx)("span",{className:"event-form-error",children:m.type})]}),(0,t.jsxs)("div",{className:"event-form-field",children:[(0,t.jsx)("label",{children:"Дата *"}),(0,t.jsx)("input",{type:"date",name:"date",value:r.date,onChange:p}),m.date&&(0,t.jsx)("span",{className:"event-form-error",children:m.date})]}),(0,t.jsxs)("div",{className:"event-form-field",children:[(0,t.jsx)("label",{children:"Адрес *"}),(0,t.jsx)("input",{type:"text",name:"address",value:r.address,onChange:p,placeholder:"Введите адрес"}),m.address&&(0,t.jsx)("span",{className:"event-form-error",children:m.address})]}),(0,t.jsxs)("div",{className:"event-form-field",children:[(0,t.jsx)("label",{children:"Автор *"}),(0,t.jsx)("input",{type:"text",name:"author",value:r.author,onChange:p,placeholder:"Ваше имя"}),m.author&&(0,t.jsx)("span",{className:"event-form-error",children:m.author})]}),(0,t.jsxs)("div",{className:"event-form-actions",children:[(0,t.jsx)(c.$n,{type:"button",onClick:s,className:"event-form-btn-cancel",children:"Отмена"}),(0,t.jsx)(c.$n,{type:"submit",disabled:h,className:"event-form-btn-submit",children:h?"Создание...":"Создать"})]})]})]})})}a(3545),a(3065);var m=a(2845);a(2715);let u=()=>window.WebApp?window.WebApp:(console.warn("WebApp is not available"),null);function p(){let e=null;if(u()){console.log("Я получил виндовс"),console.log(s.user.first_name);let s=window.WebApp.initDataUnsafe;e=s.user.id}else console.log("Я ничево неполучил");let[s,a]=(0,l.useState)("all"),[n,r]=(0,l.useState)(!1),{events:c,loading:i,refetch:d}=(0,m.L)(),{events:o,loading:p}=(0,m.n)(e),j="all"===s?c:o;return(0,t.jsxs)("div",{className:"events-view",children:[(0,t.jsxs)("div",{className:"events-header",children:[(0,t.jsx)("h1",{className:"events-title",children:"События"}),(0,t.jsx)("button",{onClick:()=>r(!0),className:"events-add-btn",children:"+ Добавить"})]}),(0,t.jsxs)("div",{className:"events-tabs",children:[(0,t.jsx)("button",{onClick:()=>a("all"),className:"events-tab ".concat("all"===s?"active":""),children:"Все события"}),(0,t.jsx)("button",{onClick:()=>a("my"),className:"events-tab ".concat("my"===s?"active":""),children:"Мои события"})]}),("all"===s?i:p)?(0,t.jsxs)("div",{className:"events-loading",children:[(0,t.jsx)("div",{className:"spinner"}),(0,t.jsx)("p",{children:"Загрузка..."})]}):0===j.length?(0,t.jsx)("div",{className:"events-empty",children:(0,t.jsx)("p",{children:"Событий пока нет"})}):(0,t.jsx)("div",{className:"events-list",children:j.map(s=>(0,t.jsx)(h,{event:s,isJoined:o.some(e=>e.id===s.id),userId:e,onJoinSuccess:d},s.id))}),n&&(0,t.jsx)(v,{onClose:()=>r(!1),onSuccess:()=>{d()},userId:MOCK_USER_ID})]})}function j(){return(0,t.jsx)(n.A,{children:(0,t.jsx)(p,{})})}},504:(e,s,a)=>{"use strict";a.d(s,{getMyEvents:()=>c,kQ:()=>r,lh:()=>i,ns:()=>d});var t=a(2651);let n="https://ecology-app-test.vercel.app",l=t.A.create({baseURL:n,headers:{"Content-Type":"application/json"}}),r=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=new URLSearchParams;e.forEach(e=>s.append("type",e));let a="/events".concat(s.toString()?"?"+s.toString():"");return console.log(n),console.log(a),(await l.get(a)).data},c=async e=>(await l.get("/events/my?userId=".concat(e))).data,i=async e=>(await l.post("/events",e)).data,d=async(e,s)=>(await l.post("/join",{userId:e,eventId:s})).data},237:(e,s,a)=>{"use strict";a.d(s,{A:()=>c});var t=a(5155),n=a(6046),l=a(2021);function r(){let e=(0,n.usePathname)(),s=(0,n.useRouter)();return(0,t.jsx)("nav",{className:"bottom-navigation",children:[{path:"/",label:"Карты"},{path:"/events",label:"События"},{path:"/profile",label:"Профиль"}].map(a=>(0,t.jsx)(l.T0,{onClick:()=>s.push(a.path),className:e===a.path?"active":"",children:a.label},a.path))})}function c(e){let{children:s}=e;return(0,t.jsxs)("div",{className:"app-layout",children:[(0,t.jsx)("main",{className:"app-content",children:s}),(0,t.jsx)(r,{})]})}a(4409),a(203)},3596:(e,s,a)=>{"use strict";a.d(s,{f:()=>r,v:()=>c});var t=a(5155),n=a(2115);let l=(0,n.createContext)(void 0);function r(e){let{children:s}=e,[a,r]=(0,n.useState)(null);return(0,t.jsx)(l.Provider,{value:{selectedEvent:a,setSelectedEvent:r},children:s})}function c(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useSelectedEvent must be used within SelectedEventProvider");return e}},2845:(e,s,a)=>{"use strict";a.d(s,{L:()=>l,n:()=>r});var t=a(2115),n=a(504);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[s,a]=(0,t.useState)([]),[l,r]=(0,t.useState)(!0),[c,i]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{try{r(!0);let s=await (0,n.kQ)(e);a(s),i(null)}catch(e){i(e.message),a([])}finally{r(!1)}})()},[e.join(",")]),{events:s,loading:l,error:c,refetch:()=>(0,n.kQ)(e).then(a)}}function r(e){let[s,n]=(0,t.useState)([]),[l,r]=(0,t.useState)(!0),[c,i]=(0,t.useState)(null);return(0,t.useEffect)(()=>{let s=async()=>{try{r(!0);let{getMyEvents:s}=await Promise.resolve().then(a.bind(a,504)),t=await s(e);n(t),i(null)}catch(e){i(e.message),n([])}finally{r(!1)}};e&&s()},[e]),{events:s,loading:l,error:c}}},8494:(e,s,a)=>{"use strict";a.d(s,{B:()=>t,S:()=>n});let t={SUBBOTNIK:"SUBBOTNIK",PAPER_COLLECTION:"PAPER COLLECTION",BATTERY_COLLECTION:"BATTERY COLLECTION",PLASTIC_COLLECTION:"PLASTIC COLLECTION",GLASS_COLLECTION:"GLASS COLLECTION",ELECTRONICS_COLLECTION:"ELECTRONICS COLLECTION",OTHER:"OTHER"},n={[t.SUBBOTNIK]:"Субботник",[t.PAPER_COLLECTION]:"Сбор бумаги",[t.BATTERY_COLLECTION]:"Сбор батареек",[t.PLASTIC_COLLECTION]:"Сбор пластика",[t.GLASS_COLLECTION]:"Сбор стекла",[t.ELECTRONICS_COLLECTION]:"Сбор электроники",[t.OTHER]:"Другое"}},4409:()=>{},3545:()=>{},3065:()=>{},203:()=>{},2715:()=>{}},e=>{var s=s=>e(e.s=s);e.O(0,[953,60,810,651,441,517,358],()=>s(884)),_N_E=e.O()}]);