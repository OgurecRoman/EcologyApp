(()=>{var e={};e.id=634,e.ids=[634],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2412:e=>{"use strict";e.exports=require("assert")},5511:e=>{"use strict";e.exports=require("crypto")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},3496:e=>{"use strict";e.exports=require("http2")},5591:e=>{"use strict";e.exports=require("https")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},4075:e=>{"use strict";e.exports=require("zlib")},4647:()=>{},168:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>c});var r=s(260),n=s(8203),a=s(5155),i=s.n(a),l=s(7292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["events",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8724)),"D:\\programming\\PROJECTS\\EcologyApp\\client\\app\\events\\page.jsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9611)),"D:\\programming\\PROJECTS\\EcologyApp\\client\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,1485,23)),"next/dist/client/components/unauthorized-error"]}],d=["D:\\programming\\PROJECTS\\EcologyApp\\client\\app\\events\\page.jsx"],p={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/events/page",pathname:"/events",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6028:(e,t,s)=>{Promise.resolve().then(s.bind(s,8724))},6524:(e,t,s)=>{Promise.resolve().then(s.bind(s,2298))},6957:(e,t,s)=>{Promise.resolve().then(s.bind(s,4869)),Promise.resolve().then(s.t.bind(s,6638,23)),Promise.resolve().then(s.bind(s,1112))},8397:(e,t,s)=>{Promise.resolve().then(s.bind(s,9205)),Promise.resolve().then(s.t.bind(s,7882,23)),Promise.resolve().then(s.bind(s,4676))},7800:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,3219,23)),Promise.resolve().then(s.t.bind(s,4863,23)),Promise.resolve().then(s.t.bind(s,5155,23)),Promise.resolve().then(s.t.bind(s,802,23)),Promise.resolve().then(s.t.bind(s,9350,23)),Promise.resolve().then(s.t.bind(s,8530,23)),Promise.resolve().then(s.t.bind(s,8921,23))},7528:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6959,23)),Promise.resolve().then(s.t.bind(s,3875,23)),Promise.resolve().then(s.t.bind(s,1284,23)),Promise.resolve().then(s.t.bind(s,7174,23)),Promise.resolve().then(s.t.bind(s,4178,23)),Promise.resolve().then(s.t.bind(s,7190,23)),Promise.resolve().then(s.t.bind(s,1365,23))},2298:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var r=s(5512),n=s(4873),a=s(8009),i=s(9334),l=s(1367),o=s(3312),c=s(6026),d=s(7072);function p({event:e,isJoined:t,userId:s,onJoinSuccess:n}){let p=(0,i.useRouter)(),{setSelectedEvent:u}=(0,d.v)(),[m,h]=(0,a.useState)(!1),[v,x]=(0,a.useState)(t),j=async()=>{if(!s){alert("Необходима авторизация");return}try{h(!0),await (0,o.ns)(s,e.id),x(!0),n&&n()}catch(e){console.error("Failed to join event:",e),alert("Ошибка при записи на событие")}finally{h(!1)}};return(0,r.jsxs)("div",{className:"event-card",children:[(0,r.jsxs)("div",{className:"event-card-header",children:[(0,r.jsx)("h3",{className:"event-card-title",children:e.name}),(0,r.jsx)("span",{className:"event-card-type",children:c.S[e.type]||e.type})]}),(0,r.jsxs)("div",{className:"event-card-body",children:[e.description&&(0,r.jsx)("p",{className:"event-card-description",children:e.description}),(0,r.jsxs)("div",{className:"event-card-info",children:[(0,r.jsxs)("div",{className:"event-card-info-item",children:[(0,r.jsx)("span",{className:"event-card-label",children:"Дата:"}),(0,r.jsx)("span",{children:new Date(e.date).toLocaleDateString("ru-RU")})]}),(0,r.jsxs)("div",{className:"event-card-info-item",children:[(0,r.jsx)("span",{className:"event-card-label",children:"Адрес:"}),(0,r.jsx)("span",{children:e.address})]}),(0,r.jsxs)("div",{className:"event-card-info-item",children:[(0,r.jsx)("span",{className:"event-card-label",children:"Автор:"}),(0,r.jsx)("span",{children:e.author})]})]})]}),(0,r.jsxs)("div",{className:"event-card-actions",children:[(0,r.jsx)(l.$n,{onClick:()=>{u(e),p.push("/")},className:"event-card-btn-secondary",children:"Показать на карте"}),v?(0,r.jsx)("div",{className:"event-card-joined",children:"Вы записаны!"}):(0,r.jsx)(l.$n,{onClick:j,disabled:m,className:"event-card-btn-primary",children:m?"Запись...":"Записаться"})]})]})}function u({onClose:e,onSuccess:t,userId:s}){let[n,i]=(0,a.useState)({name:"",description:"",type:c.B.SUBBOTNIK,date:"",address:"",author:""}),[d,p]=(0,a.useState)(!1),[u,m]=(0,a.useState)({}),h=e=>{let{name:t,value:s}=e.target;i(e=>({...e,[t]:s})),u[t]&&m(e=>({...e,[t]:""}))},v=()=>{let e={};return n.name.trim()||(e.name="Название обязательно"),n.type||(e.type="Выберите тип события"),n.date||(e.date="Дата обязательна"),n.address.trim()||(e.address="Адрес обязателен"),n.author.trim()||(e.author="Автор обязателен"),m(e),0===Object.keys(e).length},x=async r=>{if(r.preventDefault(),v())try{p(!0),await (0,o.lh)({...n,userId:s}),t?.(),e()}catch(e){console.error("Failed to create event:",e),alert("Ошибка при создании события")}finally{p(!1)}};return(0,r.jsx)("div",{className:"event-form-overlay",onClick:e,children:(0,r.jsxs)("div",{className:"event-form-modal",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"event-form-header",children:[(0,r.jsx)("h2",{children:"Добавить событие"}),(0,r.jsx)(l.$n,{onClick:e,className:"event-form-close",children:"\xd7"})]}),(0,r.jsxs)("form",{onSubmit:x,className:"event-form",children:[(0,r.jsxs)("div",{className:"event-form-field",children:[(0,r.jsx)("label",{children:"Название *"}),(0,r.jsx)("input",{type:"text",name:"name",value:n.name,onChange:h,placeholder:"Введите название события"}),u.name&&(0,r.jsx)("span",{className:"event-form-error",children:u.name})]}),(0,r.jsxs)("div",{className:"event-form-field",children:[(0,r.jsx)("label",{children:"Описание"}),(0,r.jsx)("textarea",{name:"description",value:n.description,onChange:h,placeholder:"Описание события",rows:4})]}),(0,r.jsxs)("div",{className:"event-form-field",children:[(0,r.jsx)("label",{children:"Тип события *"}),(0,r.jsx)("select",{name:"type",value:n.type,onChange:h,children:Object.values(c.B).map(e=>(0,r.jsx)("option",{value:e,children:c.S[e]},e))}),u.type&&(0,r.jsx)("span",{className:"event-form-error",children:u.type})]}),(0,r.jsxs)("div",{className:"event-form-field",children:[(0,r.jsx)("label",{children:"Дата *"}),(0,r.jsx)("input",{type:"date",name:"date",value:n.date,onChange:h}),u.date&&(0,r.jsx)("span",{className:"event-form-error",children:u.date})]}),(0,r.jsxs)("div",{className:"event-form-field",children:[(0,r.jsx)("label",{children:"Адрес *"}),(0,r.jsx)("input",{type:"text",name:"address",value:n.address,onChange:h,placeholder:"Введите адрес"}),u.address&&(0,r.jsx)("span",{className:"event-form-error",children:u.address})]}),(0,r.jsxs)("div",{className:"event-form-field",children:[(0,r.jsx)("label",{children:"Автор *"}),(0,r.jsx)("input",{type:"text",name:"author",value:n.author,onChange:h,placeholder:"Ваше имя"}),u.author&&(0,r.jsx)("span",{className:"event-form-error",children:u.author})]}),(0,r.jsxs)("div",{className:"event-form-actions",children:[(0,r.jsx)(l.$n,{type:"button",onClick:e,className:"event-form-btn-cancel",children:"Отмена"}),(0,r.jsx)(l.$n,{type:"submit",disabled:d,className:"event-form-btn-submit",children:d?"Создание...":"Создать"})]})]})]})})}s(2303),s(1247);var m=s(251);s(3803);let h=()=>(console.warn("WebApp is not available"),null);function v(){let e=null;if(h()){console.log("Я получил виндовс"),console.log(t.user.first_name);let t=window.WebApp.initDataUnsafe;e=t.user.id}else console.log("Я ничево неполучил");let[t,s]=(0,a.useState)("all"),[n,i]=(0,a.useState)(!1),{events:l,loading:o,refetch:c}=(0,m.L)(),{events:d,loading:v}=(0,m.n)(e),x="all"===t?l:d;return(0,r.jsxs)("div",{className:"events-view",children:[(0,r.jsxs)("div",{className:"events-header",children:[(0,r.jsx)("h1",{className:"events-title",children:"События"}),(0,r.jsx)("button",{onClick:()=>i(!0),className:"events-add-btn",children:"+ Добавить"})]}),(0,r.jsxs)("div",{className:"events-tabs",children:[(0,r.jsx)("button",{onClick:()=>s("all"),className:`events-tab ${"all"===t?"active":""}`,children:"Все события"}),(0,r.jsx)("button",{onClick:()=>s("my"),className:`events-tab ${"my"===t?"active":""}`,children:"Мои события"})]}),("all"===t?o:v)?(0,r.jsxs)("div",{className:"events-loading",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{children:"Загрузка..."})]}):0===x.length?(0,r.jsx)("div",{className:"events-empty",children:(0,r.jsx)("p",{children:"Событий пока нет"})}):(0,r.jsx)("div",{className:"events-list",children:x.map(t=>(0,r.jsx)(p,{event:t,isJoined:d.some(e=>e.id===t.id),userId:e,onJoinSuccess:c},t.id))}),n&&(0,r.jsx)(u,{onClose:()=>i(!1),onSuccess:()=>{c()},userId:MOCK_USER_ID})]})}function x(){return(0,r.jsx)(n.A,{children:(0,r.jsx)(v,{})})}},3312:(e,t,s)=>{"use strict";s.d(t,{getMyEvents:()=>a,kQ:()=>n,lh:()=>i,ns:()=>l});let r=s(4361).A.create({baseURL:"https://ecology-app-test.vercel.app",headers:{"Content-Type":"application/json"}}),n=async(e=[])=>{let t=new URLSearchParams;e.forEach(e=>t.append("type",e));let s=`/events${t.toString()?"?"+t.toString():""}`;return(await r.get(s)).data},a=async e=>(await r.get(`/events/my?userId=${e}`)).data,i=async e=>(await r.post("/events",e)).data,l=async(e,t)=>(await r.post("/join",{userId:e,eventId:t})).data},4676:(e,t,s)=>{"use strict";s.d(t,{default:()=>a});var r=s(5512),n=s(7072);function a({children:e}){return(0,r.jsx)(n.f,{children:e})}},4873:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(5512),n=s(9334),a=s(1367);function i(){let e=(0,n.usePathname)(),t=(0,n.useRouter)();return(0,r.jsx)("nav",{className:"bottom-navigation",children:[{path:"/",label:"Карты"},{path:"/events",label:"События"},{path:"/profile",label:"Профиль"}].map(s=>(0,r.jsx)(a.T0,{onClick:()=>t.push(s.path),className:e===s.path?"active":"",children:s.label},s.path))})}function l({children:e}){return(0,r.jsxs)("div",{className:"app-layout",children:[(0,r.jsx)("main",{className:"app-content",children:e}),(0,r.jsx)(i,{})]})}s(2595),s(1953)},7072:(e,t,s)=>{"use strict";s.d(t,{f:()=>i,v:()=>l});var r=s(5512),n=s(8009);let a=(0,n.createContext)(void 0);function i({children:e}){let[t,s]=(0,n.useState)(null);return(0,r.jsx)(a.Provider,{value:{selectedEvent:t,setSelectedEvent:s},children:e})}function l(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useSelectedEvent must be used within SelectedEventProvider");return e}},251:(e,t,s)=>{"use strict";s.d(t,{L:()=>a,n:()=>i});var r=s(8009),n=s(3312);function a(e=[]){let[t,s]=(0,r.useState)([]),[i,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{try{l(!0);let t=await (0,n.kQ)(e);s(t),c(null)}catch(e){c(e.message),s([])}finally{l(!1)}})()},[e.join(",")]),{events:t,loading:i,error:o,refetch:()=>(0,n.kQ)(e).then(s)}}function i(e){let[t,s]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[i,l]=(0,r.useState)(null);return{events:t,loading:n,error:i}}},6026:(e,t,s)=>{"use strict";s.d(t,{B:()=>r,S:()=>n});let r={SUBBOTNIK:"SUBBOTNIK",PAPER_COLLECTION:"PAPER COLLECTION",BATTERY_COLLECTION:"BATTERY COLLECTION",PLASTIC_COLLECTION:"PLASTIC COLLECTION",GLASS_COLLECTION:"GLASS COLLECTION",ELECTRONICS_COLLECTION:"ELECTRONICS COLLECTION",OTHER:"OTHER"},n={[r.SUBBOTNIK]:"Субботник",[r.PAPER_COLLECTION]:"Сбор бумаги",[r.BATTERY_COLLECTION]:"Сбор батареек",[r.PLASTIC_COLLECTION]:"Сбор пластика",[r.GLASS_COLLECTION]:"Сбор стекла",[r.ELECTRONICS_COLLECTION]:"Сбор электроники",[r.OTHER]:"Другое"}},8724:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\programming\\\\PROJECTS\\\\EcologyApp\\\\client\\\\app\\\\events\\\\page.jsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\programming\\PROJECTS\\EcologyApp\\client\\app\\events\\page.jsx","default")},9611:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,metadata:()=>l});var r=s(2740),n=s(9847),a=s(4869);s(2704);var i=s(1112);let l={title:"Ecology Events - Карта экологических событий",description:"Платформа для поиска и участия в экологических событиях: субботниках, сборе макулатуры, батареек и других мероприятиях",generator:"v0.app",icons:{icon:[{url:"/icon-light-32x32.png",media:"(prefers-color-scheme: light)"},{url:"/icon-dark-32x32.png",media:"(prefers-color-scheme: dark)"},{url:"/icon.svg",type:"image/svg+xml"}],apple:"/apple-icon.png"}};function o({children:e}){return(0,r.jsx)("html",{lang:"ru",suppressHydrationWarning:!0,children:(0,r.jsxs)("body",{className:"font-sans antialiased",children:[(0,r.jsx)(i.default,{children:e}),(0,r.jsx)(n.default,{src:"https://st.max.ru/js/max-web-app.js",strategy:"beforeInteractive"}),(0,r.jsx)(a.Analytics,{})]})})}},1112:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});let r=(0,s(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\programming\\\\PROJECTS\\\\EcologyApp\\\\client\\\\src\\\\components\\\\ClientLayout\\\\ClientLayout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\programming\\PROJECTS\\EcologyApp\\client\\src\\components\\ClientLayout\\ClientLayout.tsx","default")},2704:()=>{},2595:()=>{},2303:()=>{},1247:()=>{},1953:()=>{},3803:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[358,367,361],()=>s(168));module.exports=r})();